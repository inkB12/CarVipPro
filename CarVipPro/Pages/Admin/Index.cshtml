@page
@model CarVipPro.APrenstationLayer.Pages.Admin.IndexModel
@{
    Layout = "_LayoutAdmin";
    ViewData["Title"] = "Bảng điều khiển quản trị";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />

<div class="container-fluid px-3 animate__animated animate__fadeIn">
    <h3 class="fw-bold mb-4 text-light">👋 Chào mừng trở lại, <span class="text-primary">Admin</span>!</h3>

    <!-- Spinner -->
    <div id="loadingSpinner" class="text-center my-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2 text-secondary">Đang tải dữ liệu...</p>
    </div>

    <div id="dashboardContent" style="display:none;">
        <!-- Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card animate__animated animate__zoomIn" style="animation-delay:0.1s;">
                    <div class="card-body text-center">
                        <i class="bi bi-building fs-2 text-primary"></i>
                        <h2 class="fw-bold mt-2 counter" data-target="@Model.TotalCompanies">0</h2>
                        <p class="text-secondary mb-0">Hãng Xe</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card animate__animated animate__zoomIn" style="animation-delay:0.2s;">
                    <div class="card-body text-center">
                        <i class="bi bi-lightning-charge fs-2 text-warning"></i>
                        <h2 class="fw-bold mt-2 counter" data-target="@Model.TotalVehicles">0</h2>
                        <p class="text-secondary mb-0">Xe Điện</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card animate__animated animate__zoomIn" style="animation-delay:0.3s;">
                    <div class="card-body text-center">
                        <i class="bi bi-tags fs-2 text-success"></i>
                        <h2 class="fw-bold mt-2 counter" data-target="@Model.TotalCategories">0</h2>
                        <p class="text-secondary mb-0">Loại Xe</p>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card animate__animated animate__zoomIn" style="animation-delay:0.4s;">
                    <div class="card-body text-center">
                        <i class="bi bi-receipt fs-2 text-info"></i>
                        <h2 class="fw-bold mt-2 counter" data-target="@Model.TotalOrders">0</h2>
                        <p class="text-secondary mb-0">Đơn Hàng</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card animate__animated animate__zoomIn">
                    <div class="card-body">
                        <h6 class="fw-bold text-light"><i class="bi bi-bar-chart-line"></i> Thống kê tổng quan</h6>
                        <canvas id="adminChart" height="150"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card animate__animated animate__zoomIn">
                    <div class="card-body">
                        <h6 class="fw-bold text-light"><i class="bi bi-pie-chart"></i> Tỉ lệ Xe / Hãng / Đơn</h6>
                        <canvas id="pieChart" height="150"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        window.addEventListener("load", function () {
            setTimeout(() => {
                document.getElementById("loadingSpinner").style.display = "none";
                document.getElementById("dashboardContent").style.display = "block";
                animateCounters();
                renderCharts();
            }, 800);
        });

        // Hiệu ứng đếm
        function animateCounters() {
            document.querySelectorAll(".counter").forEach(counter => {
                const target = +counter.getAttribute("data-target");
                let count = 0;
                const step = target / 50;
                const speed = 20;
                const update = () => {
                    count += step;
                    if (count < target) {
                        counter.innerText = Math.floor(count);
                        setTimeout(update, speed);
                    } else {
                        counter.innerText = target.toLocaleString();
                    }
                };
                update();
            });
        }

        // Render Charts
        function renderCharts() {
            const barCtx = document.getElementById('adminChart');
            const pieCtx = document.getElementById('pieChart');

            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Hãng Xe', 'Xe Điện', 'Loại Xe', 'Đơn Hàng'],
                    datasets: [{
                        label: 'Số lượng',
                        data: [@Model.TotalCompanies, @Model.TotalVehicles, @Model.TotalCategories, @Model.TotalOrders],
                        backgroundColor: ['#6366f1', '#facc15', '#22d3ee', '#06b6d4'],
                        borderRadius: 8
                    }]
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: '#cbd5e1' } },
                        y: { ticks: { color: '#cbd5e1' } }
                    }
                }
            });

            new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Xe Điện', 'Hãng Xe', 'Loại Xe', 'Đơn Hàng'],
                    datasets: [{
                        data: [@Model.TotalVehicles, @Model.TotalCompanies, @Model.TotalCategories, @Model.TotalOrders],
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#22d3ee', '#06b6d4']
                    }]
                },
                options: {
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#e2e8f0' } }
                    }
                }
            });
        }
    </script>
}
